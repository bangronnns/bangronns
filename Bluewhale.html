<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Game Tangkap Paus Biru</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    overflow: hidden;
    touch-action: none; /* mencegah scroll/zoom */
  }
  #info {
    font-size: 24px;
    padding: 10px;
  }
  canvas {
    display: block;
    background: black;
  }
  /* Analog joystick */
  #joystickBase {
    display: none; /* default hidden */
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    width: 180px;
    height: 180px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    touch-action: none;
  }
  #joystickStick {
    position: absolute;
    width: 90px;
    height: 90px;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    left: 45px;
    top: 45px;
    touch-action: none;
  }
</style>
</head>
<body>
<div id="info">üéØ Tangkap paus biru üê≥</div>
<canvas id="gameCanvas"></canvas>

<div id="joystickBase">
  <div id="joystickStick"></div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Perahu besar
let catcher = {
  x: canvas.width / 2 - 60,
  y: canvas.height - 120,
  width: 140,
  height: 60,
  speed: 8
};

let emojis = [
  "üê≥", "üê°", "ü¶ê", "ü¶û", "üê†",
  "üíô", "üíõ", "üß°", "üíú", "üíö", "ü§ç", "‚ù§Ô∏è", "üíó", "üíñ", "üíò", "üíì"
];
let falling = [];

function spawnEmote() {
  let emoji = emojis[Math.floor(Math.random() * emojis.length)];
  falling.push({
    emoji: emoji,
    x: Math.random() * (canvas.width - 50),
    y: -50,
    speed: 3 + Math.random() * 4.5
  });
}

function drawCatcher() {
  ctx.font = "120px Arial"; // perahu besar
  ctx.fillText("üõ∂", catcher.x, catcher.y + 60);
}

function drawEmotes() {
  ctx.font = "50px Arial"; // emoji jatuh besar
  ctx.fillStyle = "white";
  for (let obj of falling) {
    ctx.fillText(obj.emoji, obj.x, obj.y);
  }
}

function updateEmotes() {
  for (let i = falling.length - 1; i >= 0; i--) {
    falling[i].y += falling[i].speed;

    let emoteWidth = 50;
    let emoteHeight = 50;

    // Deteksi tabrak
    if (
      falling[i].y + emoteHeight >= catcher.y &&
      falling[i].y <= catcher.y + catcher.height &&
      falling[i].x + emoteWidth >= catcher.x &&
      falling[i].x <= catcher.x + catcher.width
    ) {
      if (falling[i].emoji === "üê≥") {
        menangTangkapPausBiru();
      }
      falling.splice(i, 1);
    }
    else if (falling[i].y > canvas.height) {
      falling.splice(i, 1);
    }
  }
}

function menangTangkapPausBiru() {
  let pesan = prompt("vanyyy, Yang pengen kamu bilang ke Tian apaaa??:");
  if (pesan) {
    fetch(`https://memek-worker.defoy89122.workers.dev/?message=${encodeURIComponent(pesan)}`)
      .then(() => {
        repeatAlert(pesan, 10); // alert pesan dari input 10x
      });
  }
}

function repeatAlert(message, times) {
  for (let i = 0; i < times; i++) {
    alert(message);
  }
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawCatcher();
  drawEmotes();
  updateEmotes();
  requestAnimationFrame(gameLoop);
}

// Spawn cepat
setInterval(spawnEmote, 350);

// ===== Joystick Control =====
let joystickBase = document.getElementById("joystickBase");
let joystickStick = document.getElementById("joystickStick");
let joystickActive = false;
let joystickCenter = { x: 0, y: 0 };
let moveDirection = 0;

function initJoystick() {
  if (/Mobi|Android/i.test(navigator.userAgent)) {
    joystickBase.style.display = "block"; // tampilkan hanya di mobile
    let rect = joystickBase.getBoundingClientRect();
    joystickCenter = { x: rect.width / 2, y: rect.height / 2 };
  }
}
initJoystick();

joystickBase.addEventListener("touchstart", startJoystick, false);
joystickBase.addEventListener("touchmove", moveJoystick, false);
joystickBase.addEventListener("touchend", endJoystick, false);

function startJoystick(e) {
  joystickActive = true;
  moveJoystick(e);
}

function moveJoystick(e) {
  if (!joystickActive) return;
  let touch = e.touches[0];
  let rect = joystickBase.getBoundingClientRect();
  let x = touch.clientX - rect.left;
  let y = touch.clientY - rect.top;
  let dx = x - joystickCenter.x;
  let dy = y - joystickCenter.y;
  let distance = Math.sqrt(dx * dx + dy * dy);
  let maxDistance = rect.width / 2;

  if (distance > maxDistance) {
    dx = dx / distance * maxDistance;
    dy = dy / distance * maxDistance;
  }

  joystickStick.style.left = (joystickCenter.x + dx - joystickStick.offsetWidth / 2) + "px";
  joystickStick.style.top = (joystickCenter.y + dy - joystickStick.offsetHeight / 2) + "px";

  moveDirection = dx / maxDistance; // -1 kiri, +1 kanan
}

function endJoystick() {
  joystickActive = false;
  moveDirection = 0;
  joystickStick.style.left = (joystickCenter.x - joystickStick.offsetWidth / 2) + "px";
  joystickStick.style.top = (joystickCenter.y - joystickStick.offsetHeight / 2) + "px";
}

function updateCatcherPosition() {
  if (moveDirection < -0.1) {
    catcher.x -= catcher.speed;
  } else if (moveDirection > 0.1) {
    catcher.x += catcher.speed;
  }
  if (catcher.x < 0) catcher.x = 0;
  if (catcher.x + catcher.width > canvas.width) catcher.x = canvas.width - catcher.width;
  requestAnimationFrame(updateCatcherPosition);
}
updateCatcherPosition();

gameLoop();
</script>
</body>
</html>
